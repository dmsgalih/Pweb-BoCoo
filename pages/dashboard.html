<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoCoo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles/style.css">

    <script src="https://kit.fontawesome.com/d79b975262.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
</head>

<body>
    <div class="d-flex">
        <div id="sidebar" class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark" style="width: 280px;">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                <svg class="bi pe-none me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
                <span class="fs-4">Dashboard</span>
            </a>
            <hr>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a id="book-link" href="#" class="nav-link active" aria-current="page">
                        Book
                    </a>
                </li>
                <li>
                    <a id="genre-link" href="#" class="nav-link text-white ">
                        Genre
                    </a>

                </li>
                <li class="mt-4">
                    <a href="../index.html" class="btn btn-danger">
                        Back to home
                    </a>

                </li>
            </ul>
        </div>

        <div class="d-flex p-5" id="dashboard-content">

        </div>
    </div>

    <!-- Modal Edit Genre-->
    <div class="modal fade" id="editBookModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Book</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-book-form" action="../controller/book.php?action=edit" method="post" enctype="multipart/form-data">
                        <input type="hidden" id="book_id" name="book_id">
                        <div class="mb-3">
                            <label for="genre" class="form-label">Book Name</label>
                            <input type="text" class="form-control" id="book-name" name="book-name">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Genre</label>
                            <select class="form-select" id="genre-select" name="genre_id" aria-label="Default select example">
                                
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Recently Book Image</label>
                            <input type="hidden" class="form-control" id="recenly-book-image" name="recenly-book-image">
                            <img id="book-img" src="" style="width: 300px;" alt="">
                        </div>
                        <div class="mb-3">
                            <label for="genre" class="form-label">New Book Image</label>
                            <input type="file" class="form-control" id="book-image" name="book-image">
                            <input type="hidden" value="Upload Image" name="submit">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Writer</label>
                            <input type="text" class="form-control" id="writer" name="writer">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Rating</label>
                            <input type="text" class="form-control" id="rating" name="rating">
                        </div>

                        <div class="mb-3">
                            <label for="sinopsis" class="form-label">Sinopsis</label>
                            <textarea class="form-control" id="sinopsis" name="sinopsis" rows="3"></textarea>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Edit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Delete Book-->
    <div class="modal fade" id="deleteBookModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Book</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>do you really want to remove <span id="book-name"></span> from the genre ?</p>
                    <form id="delete-book-form" method="post">
                        <input type="hidden" id="delete_genre_id" name="book_id">

                        <div class="d-flex justify-content-center">
                            <button type="button" class="btn btn-primary me-3" data-bs-dismiss="modal">No</button>
                            <button type="submit" class="btn btn-danger">Yes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Create Book-->
    <div class="modal fade" id="createBookModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Book</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create-book-form" method="post" action="../controller/book.php?action=create" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="genre" class="form-label">Book Name</label>
                            <input type="text" class="form-control" id="book-name" name="book-name">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Genre</label>
                            <select class="form-select" id="genre-select-create" name="genre_id" aria-label="Default select example">
                                
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Book Image</label>
                            <input type="file" class="form-control" id="book-image" name="book-image">
                            <input type="hidden" value="Upload Image" name="submit">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Writer</label>
                            <input type="text" class="form-control" id="writer" name="writer">
                        </div>

                        <div class="mb-3">
                            <label for="genre" class="form-label">Rating</label>
                            <input type="text" class="form-control" id="rating" name="rating">
                        </div>

                        <div class="mb-3">
                            <label for="sinopsis" class="form-label">Sinopsis</label>
                            <textarea class="form-control" id="sinopsis" name="sinopsis" rows="3"></textarea>
                        </div>


                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Create</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Delete Genre-->
    <div class="modal fade" id="deleteGenreModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Genre</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>do you really want to remove <span id="genre-name"></span> from the genre ?</p>
                    <form id="delete-genre-form" method="post">
                        <input type="hidden" id="delete_genre_id" name="genre_id">

                        <div class="d-flex justify-content-center">
                            <button type="button" class="btn btn-primary me-3" data-bs-dismiss="modal">No</button>
                            <button type="submit" class="btn btn-danger">Yes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Create Genre-->
    <div class="modal fade" id="createGenreModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Genre</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create-genre-form" method="post">
                        <div class="mb-3">
                            <label for="genre" class="form-label">Genre</label>
                            <input type="text" class="form-control" id="genre" name="genre">

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Create</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit Genre-->
    <div class="modal fade" id="editGenreModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Genre</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-genre-form" method="post">
                        <input type="hidden" id="genre_id" name="genre_id">
                        <div class="mb-3">
                            <label for="edit-genre" class="form-label">Recently Genre</label>
                            <input type="text" class="form-control" id="recenly-genre" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="edit-genre" class="form-label">New Genre</label>
                            <input type="text" class="form-control" id="edit-genre" name="genre">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Edit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        (function($) {
            $.fn.call_genre = function() {
                $.get('../controller/genre.php', function(response) {
                    var num = 1;
                    $.each(response, function(key, value) {
                        $('#table-genre-content').append(
                            '<tr>' +
                            '<th>' + num++ + '</th>' +
                            '<td>' + value.genre + '</td>' +
                            '<td>' +
                            '<a href="#" id="btn-edit-genre" class="btn btn-primary p-1 me-2" title="button edit" data-bs-toggle="modal" data-bs-target="#editGenreModal" data-genre="' + value.genre + '" data-id="' + value.id + '"><i class="fa-solid fa-pen-to-square"></i></a>' +
                            '<a href="#" id="btn-delete-genre" class="btn btn-danger p-1 " title="button delete" data-bs-toggle="modal" data-bs-target="#deleteGenreModal" data-genre="' + value.genre + '" data-id="' + value.id + '"><i class="fa-solid fa-trash"></i></a>' +
                            '</td>' +
                            '</tr>'
                        );
                    });
                });
                return this;
            };

            $.fn.genre_select = function() {
                $.get('../controller/genre.php', function(response) {
                    var num = 1;
                    $.each(response, function(key, value) {
                        $('#genre-select').append(
                            '<option value="' + value.id + '">' + value.genre + '</option>'
                        );
                    });
                });
                return this;
            };
            $.fn.genre_select_create = function() {
                $.get('../controller/genre.php', function(response) {
                    var num = 1;
                    $.each(response, function(key, value) {
                        $('#genre-select-create').append(
                            '<option value="' + value.id + '">' + value.genre + '</option>'
                        );
                    });
                });
                return this;
            };

            $.fn.call_books = function() {
                $.get('../controller/book.php?action=dashboard', function(response) {
                    var num = 1;
                    $.each(response, function(key, value) {
                        $('#book-table').append(
                            '<tr>' +
                            '<th>' + num++ + '</th>' +
                            '<td>' + value.name + '</td>' +
                            '<td><img src="' + value.image + '" alt="" srcset="" style="width:100px ;"></td>' +
                            '<td>' + value.writer + '</td>' +
                            '<td>' + value.rating + '<i class="fa-solid fa-star" style="color:#feca57;"></i></td>' +
                            '<td id="sinopsis-value">' + value.sinopsis + '</td>' +
                            '<td>' +
                            '<a href="#" id="btn-edit-book" class="btn btn-primary me-2" title="button edit" data-bs-toggle="modal" data-bs-target="#editBookModal" data-name="' + value.name + '" data-id="' + value.id + '" data-image="' + value.image + '" data-writer="' + value.writer + '" data-rating="' + value.rating + '" data-sinopsis="' + value.sinopsis + '"><i class="fa-solid fa-pen-to-square"></i></a>' +
                            '<a href="#" id="btn-delete-book" class="btn btn-danger" title="button delete" data-bs-toggle="modal" data-bs-target="#deleteBookModal" data-name="' + value.name + '" data-id="' + value.id + '"><i class="fa-solid fa-trash"></i></a>' +
                            '</td>' +
                            '</tr>'
                        );
                    });
                });
                return this;
            };
        })(jQuery);
        $(document).ready(function() {
            $(this).genre_select();
            $(this).genre_select_create();

            $('#book-link').click(function() {
                $('#book-link').prop('class', 'nav-link active');
                $('#genre-link').prop('class', 'nav-link text-white');
                $('#dashboard-content').empty();
                $('#dashboard-content').append(
                    '<div>' +
                    '<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createBookModal">Add New Book</button>' +
                    '<table class="table my-4" id="book-table">' +
                    '<thead>' +
                    '<tr>' +
                    '<th scope="col">No</th>' +
                    '<th scope="col">Book name</th>' +
                    '<th scope="col">Image</th>' +
                    '<th scope="col">Writer</th>' +
                    '<th scope="col">Rating</th>' +
                    '<th id="sinopsis-column">Sinopsis</th>' +
                    '<th scope="col">Action</th>' +
                    '</tr>' +
                    '</thead>' +
                    '<tbody id="table-genre-content">' +
                    '</tbody>' +
                    '</table>' +
                    '</div>'
                );
                $(this).call_books();
            }).trigger('click');

            $('#genre-link').click(function() {
                $('#book-link').prop('class', 'nav-link text-white');
                $('#genre-link').prop('class', 'nav-link active');
                $('#dashboard-content').empty();
                $('#dashboard-content').append(
                    '<div>' +
                    '<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGenreModal">Tambah Genre</button>' +
                    '<table class="table my-4" id="genre-table">' +
                    '<thead>' +
                    '<tr>' +
                    '<th scope="col">No</th>' +
                    '<th scope="col">Genre</th>' +
                    '<th scope="col">Action</th>' +
                    '</tr>' +
                    '</thead>' +
                    '<tbody id="table-genre-content">' +
                    '</tbody>' +
                    '</table>' +
                    '</div>'
                );
                $(document).call_genre();

            });

            $('#create-genre-form').submit(function(event) {
                event.preventDefault();
                var data = $(this).serialize();
                console.log(data);
                $.post('../controller/genre.php?action=create', data, function(response) {}).done(function() {
                    alert("Data genre berhasil ditambahkan");
                    $('#table-genre-content').empty();
                    $(document).call_genre();

                }).fail(function() {
                    alert("error");
                });
            });

            $('#edit-genre-form').submit(function(event) {
                event.preventDefault();
                var data = $(this).serialize();
                console.log(data);
                $.post('../controller/genre.php?action=edit', data, function(response) {}).done(function() {
                    alert("Data genre berhasil diubah");
                    $('#table-genre-content').empty();
                    $(document).call_genre();
                }).fail(function() {
                    alert("error");
                });
            });
            $('#delete-genre-form').submit(function(event) {
                event.preventDefault();
                var data = $(this).serialize();
                console.log(data);
                $.post('../controller/genre.php?action=delete', data, function(response) {}).done(function() {
                    alert("Data genre berhasil dihapus");
                    $('#table-genre-content').empty();
                    $(document).call_genre();
                }).fail(function() {
                    alert("error");
                });
            });

            $('#genre-table').on('click', '#btn-edit-genre', function() {
                var id = $(this).data('id');
                var genre = $(this).data('genre');

                var modal = $('#editGenreModal');
                modal.find('#genre_id').val(id);
                modal.find('#recenly-genre').val(genre);
            });


            $('#genre-table').on('click', '#btn-delete-genre', function() {
                var id = $(this).data('id');
                var genre = $(this).data('genre');

                var modal = $('#deleteGenreModal');
                modal.find('#delete_genre_id').val(id);
                modal.find('#genre-name').html(genre);
            });

            $('#book-table').on('click', '#btn-delete-book', function() {
                var id = $(this).data('id');
                var name = $(this).data('name');

                var modal = $('#deleteBookModal');
                modal.find('#delete_genre_id').val(id);
                modal.find('#book-name').html(name);
            });

            $('#book-table').on('click', '#btn-edit-book', function() {
                var id = $(this).data('id');
                var name = $(this).data('name');
                var img = $(this).data('image');
                var writer = $(this).data('writer');
                var rating = $(this).data('rating');
                var sinopsis = $(this).data('sinopsis');

                var modal = $('#editBookModal');
                modal.find('#book_id').val(id);
                modal.find('#book-name').val(name);
                modal.find('#writer').val(writer);
                modal.find('#rating').val(rating);
                modal.find('#sinopsis').val(sinopsis);
                modal.find('#recenly-book-image').val(img);
                modal.find('#book-img').prop('src', img);
            });

            $('#delete-book-form').submit(function(event) {
                event.preventDefault();
                var data = $(this).serialize();
                console.log(data);
                $.post('../controller/book.php?action=delete', data, function(response) {}).done(function() {
                    alert("Data genre berhasil dihapus");
                    $('#table-genre-content').empty();
                    $(document).call_books();
                }).fail(function() {
                    alert("error");
                });
            });

        });
    </script>
</body>

</html>